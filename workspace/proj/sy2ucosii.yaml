pattern:
- name: source
  type: process_sy
  interface:
  - {name: pdata, class: iarg, type: VoidPointer}
  - {name: out, class: port, type: Int}
  - {name: st, class: state, type: Int, value: '0'}
  - {name: schedule, class: param, value: [ns_func,os_delay]}
  - {name: oPortBinds, class: param, value: [writePort]}
  instance:
  - placeholder: ns_func
    component: source_func
    bind:
    - {replace: 1_ret,   with: out}
    - {replace: 2_state, with: st}
  - placeholder: writePort
    component: mbox_post
    inline: true
    bind:
    - {replace: output,   with: out}
    - {replace: mBox, withText: top_main_s2p1}
  - placeholder: os_delay
    component: OSTimeDlyHMSM
    bind:
    - {replace: 1_hours,   withText: '0'}
    - {replace: 2_minutes, withText: '0'}
    - {replace: 3_seconds, withText: '1'}
    - {replace: 4_miliseconds, withText: '0'}
    
- name: p1
  type: comb_sy
  interface:
  - {name: pdata, class: iarg, type: VoidPointer}
  - {name: inp, class: port, type: Int}
  - {name: out, class: port, type: Int}
  - {name: iPortBinds, class: param, value: [readPort]}
  - {name: oPortBinds, class: param, value: [writePort]}
  instance:
  - placeholder: func
    component: dummy_func
    bind:
    - {replace: 2_arg, with: inp}
    - {replace: 1_ret, with: out}
  - placeholder: readPort
    component: mbox_pend
    inline: true
    bind:
    - {replace: input, with: inp}
    - {replace: mBox, withText: top_main_s2p1}
    - {replace: timeout, withText: '0'}
  - placeholder: writePort
    component: mbox_post
    inline: true
    bind:
    - {replace: output, with: out}
    - {replace: mBox, withText: top_main_p12s}

- name: sink
  type: comb_sy
  interface:
  - {name: pdata, class: iarg, type: VoidPointer}
  - {name: inp, class: port, type: Int}
  - {name: iPortBinds, class: param, value: [readPort]}
  instance:
  - placeholder: func
    component: sink_func
    bind:
     - {replace: 1_arg, with: inp}
  - placeholder: readPort
    component: mbox_pend
    inline: true
    bind:
    - {replace: input, with: inp}
    - {replace: mBox, withText: top_main_p12s}
    - {replace: timeout, withText: '0'}

- name: top_main
  type: ucosii_main
  interface:
  - {name: TaskStack, class: state, type: StackArray512}
  - {name: Task, class: param, value: init}
  # mailboxes
  - {name: s2p1, class: state, type: OS_EVENT, constructor: mboxInit0}
  - {name: p12s, class: state, type: OS_EVENT, constructor: mboxInit0}
  instance:
  - placeholder: call_tasks
    component: init
  - placeholder: mboxInit0  # TODO: fix constructor value!
    component: OSMboxCreate
    # inline: true
    bind:
    - {replace: initVal, withText: '(void *) 0'}

- name: init
  type: ucosii_call_task
  interface:
  - {name: pdata, class: iarg, type: VoidPointer}
  # stacks
  - {name: sourceStk, class: state, type: StackArray512}
  - {name: p1Stk, class: state, type: StackArray512}
  - {name: sinkStk, class: state, type: StackArray512}
  # template parameters
  # TODO: would be nice a interface() template function that takes a string
  # and returns the dictionary element.
  - {name: tasks, class: param, value:
        [{name: source, prio: 15, stack: sourceStk},
         {name: p1,     prio: 13, stack: p1Stk},
         {name: sink,   prio: 11, stack: sinkStk}]}
  instance:
  - placeholder: dummy1 # no template function call, but triggers CoInSyDe to 
    component: source   # generate the function definition for these components
  - placeholder: dummy2
    component: p1
  - placeholder: dummy3
    component: sink
    
type:
- name: StackArray512
  class: array
  parameter:
  - {name: baseType, value: OS_STK}
  - {name: size, value: '512'}
- name: VoidPointer
  class: foreign
  targetName: "void*"
  
native:
- name: source_func
  interface:
  - {name: 2_state, class: iarg, type: Int}
  - {name: 1_ret, class: ret, type: Int}
  requirement: {include: "lib/funcs_sy.c"}

- name: dummy_func
  interface:
  - {name: 2_arg, class: iarg, type: Int}
  - {name: 1_ret, class: ret, type: Int}
  requirement: {include: "lib/funcs_sy.c"}

- name: sink_func
  interface: {name: 1_arg, class: iarg, type: Int}
  requirement:
  - include: "stdio.h"
  - include: "lib/funcs_sy.c"

