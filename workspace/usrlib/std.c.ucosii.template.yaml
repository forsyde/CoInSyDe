- name: ucosii_call_task
  requirement:
  - include: "includes.h"
  - include: "system.h"
  code: |
    INT8U err;
    
    {% for task in tasks %}
    err = OSTaskCreateExt ({{ task.name }}, NULL, {{interface(task.stack).name}} + {{int(interface(task.stack).type.arrSize) - 1}},
          {{task.prio}}, {{task.prio}}, {{interface(task.stack).name}}, {{interface(task.stack).type.arrSize}}, (void *) 0, OS_TASK_OPT_STK_CHK);
    {% endfor %}
    
    OSTaskDel(OS_PRIO_SELF);


- name: scan_sy
  code: |
    INT8U err;
  
    while (1) {  
    {% if iPortBinds %}
    {% for portbind in iPortBinds %}
        {{ placeholder(portbind) }}
    {% endfor %}
    {% endif %}

        {{ placeholder("ns_func") }}

    {% if oPortBinds %}
    {% for portbind in oPortBinds %}
        {{ placeholder(portbind) }}
    {% endfor %}
    {% endif %}
    }

- name: comb_sy
  code: |
    INT8U err;
  
    while (1) {  
    {% if iPortBinds %}
    {% for portbind in iPortBinds %}
        {{ placeholder(portbind) }}
    {% endfor %}
    {% endif %}

        {{ placeholder("func") }}

    {% if oPortBinds %}
    {% for portbind in oPortBinds %}
        {{ placeholder(portbind) }}
    {% endfor %}
    {% endif %}
    }

- name: process_sy
  code: |
    INT8U err;
  
    while (1) {  
    {% if iPortBinds %}
    {% for portbind in iPortBinds %}
        {{ placeholder(portbind) }}
    {% endfor %}
    {% endif %}

    {% for inst in schedule %}
        {{ placeholder(inst) }}
    {% endfor %}
        
    {% if oPortBinds %}
    {% for portbind in oPortBinds %}
        {{ placeholder(portbind) }}
    {% endfor %}
    {% endif %}
    }
    
- name: scan_sdf
  requirement:
  - include: "includes.h"
  code: |
    INT8U err;
  
    while (1) {  
    {% if iPortBinds %}
    {% for bind in iPortBinds %}
    {% for token in range(bind.cons) %}
        {{ interface(bind.buff).name }}[{{token}}] =  ({{interface(bind.buff).type.tyName}}*) OSQPend({{bind.queue}}, 0, &err); 
    {% endfor %}
    {% endfor %}
    {% endif %}

        {{ placeholder("ns_func") }}

    {% if oPortBinds %}
    {% for bind in oPortBinds %}
    {% for token in range(bind.prod) %}
        OSMQPost({{bind.queue}}, (void*){{interface(bind.buff).name }}[{{token}}]);
    {% endfor %}
    {% endfor %}
    {% endif %}
    }

- name: comb_sdf
  requirement:
  - include: "includes.h"
  code: |
    INT8U err;
  
    while (1) {  
    {% if iPortBinds %}
    {% for bind in iPortBinds %}
    {% for token in range(bind.cons) %}
        {{ interface(bind.buff).name }}[{{token}}] =  ({{interface(bind.buff).type.tyName}}*) OSQPend({{bind.queue}}, 0, &err); 
    {% endfor %}
    {% endfor %}
    {% endif %}

        {{ placeholder("func") }}

    {% if oPortBinds %}
    {% for bind in oPortBinds %}
    {% for token in range(bind.prod) %}
        OSMQPost({{bind.queue}}, (void*){{interface(bind.buff).name }}[{{token}}]);
    {% endfor %}
    {% endfor %}
    {% endif %}
    }
- name: process_sdf
  requirement:
  - include: "includes.h"
  code: |
    INT8U err;
  
    while (1) {  
    {% if iPortBinds %}
    {% for bind in iPortBinds %}
    {% for token in range(bind.cons) %}
        {{ interface(bind.buff).name }}[{{token}}] =  ({{interface(bind.buff).type.tyName}}*) OSQPend({{bind.queue}}, 0, &err); 
    {% endfor %}
    {% endfor %}
    {% endif %}

    {% for inst in schedule %}
        {{ placeholder(inst) }}
    {% endfor %}

    {% if oPortBinds %}
    {% for bind in oPortBinds %}
    {% for token in range(bind.prod) %}
        OSMQPost({{bind.queue}}, (void*){{interface(bind.buff).name }}[{{token}}]);
    {% endfor %}
    {% endfor %}
    {% endif %}
    }
